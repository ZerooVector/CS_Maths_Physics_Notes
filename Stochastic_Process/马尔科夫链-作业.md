#StochasticProcess  

## 4-21 正常返的充要条件
系统处在 $i$ 状态时，显然只能向着 $i+1$ 状态和 $i-1$ 状态转移。将 $i$ 状态向 $i+1$ 状态转移的概率统一地记为 $p_{i}$，向 $i-1$ 状态转移的概率统一地记为 $q_{i+1}$，那么由稳态方程，我们知道：
对于 0 状态有：
$$
f_{0}  = q_{1}f_{1}
$$
对于其他状态，有：
$$
(p_{i}+q_{i})f_{i} = p_{i-1} f_{i-1} + q_{i+1} f_{i+1} 
$$

将这个方程改写就得到（注意到 $p+q  =1$）
$$
f_{i+1} q_{i+1} - f_{i} p_{i}  = f_{i} q_{i}  -   f_{i-1} p_{i-1} 
$$
利用 $f_{0} = q_{1} f_{1}$ 的边界条件，可以直接得到：
$$
f_{i+1} q_{i+1}  - f_{i} p_{i}  = 0
$$
从而得到方程的解是：
$$
f_{i}=  f_{0} \frac{p_{0} \cdots  p_{i-1} }{q_{1} \cdots  q_{i}}
$$
因此，要使得系统是正常返的，需要使得 $y_{i}$ 有限，也就是 $\frac{p_{0} \cdots  p_{i-1} }{q_{1} \cdots  q_{i}}$ 有限即可。

## 4-30 伯努利试验的成功概率比较 / 老鼠吃药问题
将 $\sum X_{i} -  \sum Y_{i}$ 记为系统的状态，首先，如果 $X_{i} = Y_{i} = 1$ 或者 $X_{i} = Y_{i}= 0$，系统的状态是不转移的。我们只需考虑系统状态发生转移的两种情况。那么，有 $P_{1}(1-P_{2})$ 的概率从 $i$ 向 $i+1$ 转移，有 $P_{2}(1-P_{1})$ 的概率向 $i-1$ 转移。如果把这个问题和赌徒问题相类比，那么赌徒的获胜概率就是
$$
p = \frac{P_{1}(1-P_{2})}{P_{1}(1-P_{2})+ P_{2} (1-P_{1})}
$$
利用本书前面对于赌徒获胜问题的讨论，相当于一个赌徒从 $M$ 这个状态出发，走到 $2M$ 这个状态就会获胜，走到 $0$ 这个状态就会破产。利用前面的赌徒破产问题，我们知道这个概率为：
$$
P_{error} =  1- \frac{1-(q/p)^M}{1-(q/p)^{2M}}=\frac{1}{1+\lambda^{M}}
$$
利用 Wald 方程，我们知道我们有 $P_{error}$ 的概率走到 $-M$ 这个位置，有 $1-P_{error}$ 的概率走到 $+M$ 这个位置。因此：
$$
(1-P_{error})M - P_{error} M = E[N ] (P_{1} - P_{2} )
$$
从而证得结论：
$$
E[N] = \frac{M(\lambda^{M}-1)}{(P_{1} - P_{2} )(\lambda ^{M} +1)}
$$

## 4-13 正常返性和零常返性
我们知道，若一个状态 $i$ 的稳态概率 $\pi_{i}>0$，那么我们说状态 $i$ 是正常返的。那么，假设状态 $i$ 是正常返的，我们设存在 $i,j,m,n$ 使
$$
p_{ij}^{m} p_{ji}^{n} > 0  \quad p_{ii}^{s} >0
$$
那么考虑状态 $j$ 向自身转移的概率：
$$
p_{jj}^{m+n+s}  \ge  p_{ji}^{n} p_{ii}^{s} p_{ij} ^{m}  > 0 
$$
在取极限时：
$$
\pi_{j} = \lim_{s \rightarrow \infty }p_{jj}^{m+n+s} \ge p_{ij}^{m} p_{ji}^{n} \lim_{s \rightarrow\infty } p_{ii}^{s}  >0
$$
因此，与 $i$ 处在同一类中的 $j$ 也是一个常返态，也就是说，常返态是类性质。
对于某一零常返态 $j$，假设我们也能找到 $i,j,m,n$，使得
$$
p_{ij}^{m} p_{ji}^{n} > 0 
$$
那么：
$$
p_{jj}^{m+n+s} \ge  p_{ji}^{n}p_{ii}^{s} p_{ij} ^{m} \Rightarrow p_{ii}^{s} \le \frac{p_{jj}^{m+n+s} }{p_{ij}^{m} p_{ji}^{n}}
$$
那么：
$$
\pi_{i} \ = \lim_{s \rightarrow \infty} p_{ii}^{s}\le  \lim_{s \rightarrow \infty } \frac{1}{p_{ij}^{m} p_{ji}^{n} } p_{jj}^{m+n+s}  = 0
$$
那么，$i$ 也是一个零常返态。我们就证明了命题。

## 4-16 雨伞问题
这个马尔科夫链的状态是该人所在地点的雨伞数量，转移概率为：
- 若现在的状态为 $0$，则次态必定为 $r$
$$
p_{0r}= 1
$$
- 若现在的状态为 $i$，且没有下雨，则转移到的次态为 $r-i$
$$
p_{i,r-i} = 1- p
$$
- 若现在的状态为 $i$，且下雨，则转移到的次态为 $r-i+1$
$$
p_{i,r-i+1} = p
$$
写出稳态概率方程：
- $r$ 状态只能从 $0$ 状态或者 $1$ 状态转移得到：
$$
\pi_{r} = \pi_{0} + p \pi_{1}
$$
- 任意一个状态 $i$ 只能从 $r-i$ 态（不下雨）或者 $r-i+1$ 态（下雨）转移得到
$$
\pi_{i} = (1-p )\pi_{r-i}  + p \pi_{r-i+1} 
$$
- $0$ 状态只能从 $r$ 状态转移得到：
$$
\pi_{0}=  \pi_{r} (1-p)
$$
记 $q = 1-p$，则方程组的解为：
$$
\pi_{0}= \frac{q}{r+q} \quad  \pi_{i} =\frac{1}{r+q}
$$
那么，如果状态是 $0$，又下雨了，这个人就会被淋，这个概率是：
$$
\pi_{rain}=\frac{pq }{r+q}
$$

