#TraditionalComputerScience 
### 总线
特点：分时共享；优点：便于扩充和修改，便于故障诊断和维修；缺点：总线带宽是传输瓶颈
分类：
- 单向和双向
- 片内总线（在 CPU 内部）、系统总线（CPU、主存、IO 接口间互联的总线，可以看成数据、地址、控制三条线"铰在一起"）、通信总线（微机设备与外部其它系统）I/O 总线（计算机与中低速 IO 设备通信）
- 并行、串行
**系统总线**的结构：单总线、双总线（主存总线、I/O 总线）、三总线（主存总线、I/O 总线、DMA 总线）***注意：这里课件上和王道书不一样！***
评价指标：传输周期（是时钟周期的整数倍）、时钟周期、总线宽度、总线带宽 $WF/N$、总线负载、总线复用、总线猝发传输
常见标准：
![[Pasted image 20231101135715.png|400]]]
控制方式：
- 同步定时：主从设备强制同步，使用统一的时钟信号来控制发送和接收
- 异步定时：不互锁、半互锁、全互锁


### 磁盘存储器
读出数据是磁-电转换；写入则是电-磁转换。硬盘的层次：记录面、磁道、圆柱面、扇区
参数：
- 道密度：垂直于磁道方向单位长度的磁道数目，单位是道/英寸或者道/毫米
- 位密度：沿着磁道方向单位长度上二进制信息的密度，单位是位/英寸或者位/毫米
- 存储容量：非格式化、格式化（可以实际使用的）
- 平均存储时间（寻道时间、旋转时间、读写操作时间，要算的时候三个部分加起来）
- 数据传送率
- 误码率

数字磁记录方式（不知道这为什么会是重点）
- 直接记录方式
	- 归零制：1 正 0 负，中间归零
	- 不归零制：中间不清零了，真好
	- 不归零 -1 制：遇到 1 反转
- 按位编码记录方式
	- 调相制：1 由负变正；0 由正变负。连续 0，1：边界上翻转
	- 调频制：每逢边界就换向，遇 1 中间再换向
	- 改进调频制：1 换 0 不换，两 0 中间换
	- 改进改进调频制：1 换 0 不换，两 0 中间换，隔两 0 再换
![[Pasted image 20231101142024.png|400]]
![[Pasted image 20231101142035.png|400]]

### I/O 系统
主机和外设的连接方式有辐射型连接、总线型连接等。输入/输出接口（I/O 接口）是主机和外设之间的交接界面，通过接口可以实现主机和外设之间的信息交换。注意：要与“端口”的概念区分。“端口”指的是接口中一些可以读/写的寄存器，端口+控制逻辑=接口
接口的作用包括：实现主机和外设的通讯联络控制、地址译码和设备选择、数据缓冲、数据格式变换（例如，并行的转成串行的）、传递控制命令和状态信息

![[f1ff27efe7a760c7ca8ba3998f2a434.jpg|400]]
- 程序查询方式：启动 I/O 设备之后，不断查询 I/O 设备状态直到外设准备就绪（这可以从状态寄存器中的就绪标志位得出），再传送一次数据。缺点：在查询过程中，CPU 长期处于踏步等待状态，使系统效率大大降低。 CPU 在一段时间内只能和一台外设交换信息，其它设备不能同时工作。不能发现和处理预先无法估计的错误和异常情况

- 中断
	- 分类：自愿中断（程序中安排的有关指令）、强迫终端（随机出现的中断）；程序中断（响应中断请求）、简单中断（DMA）；内中断（异常）、外中断；向量中断（中断事件自己提供中断处理程序地址）、非向量中断；单重中断、多重中断
	- 程序中断的工作流程：中断请求、响应判优、（判断 CPU 是否响应中断）、中断的响应、中断处理、中断返回
	- 中断响应过程：自动操作，也就是中断隐指令（关中断、保存断点、引出中断服务程序）、保存现场和屏蔽字、开中断、执行中断服务程序、关中断、恢复现场和屏蔽字、开中断并返回。中断隐指令的过程如下图所示***注意：这里有点冲突，关中断到底在哪里进行？***。其中，向量地址可能是中断处理程序的入口地址，也有可能是中断向量表的指针（类似于间址一次）。
	- ![[Pasted image 20231101143907.png|400]]
	- 中断判优：不可屏蔽中断>内部异常>可屏蔽中断；硬件中断>软件中断；DMA>I/O 设备；高速>低速，输入>输出；实时>普通
	- CPU 响应中断的条件：CPU 接收到中断请求信号、开中断、一条指令执行完成
	- 中断屏蔽字的设置

- DMA
	- DMA 是一种完全依赖硬件的数据传送方式。对这个过程控制的硬件称为 DMA 控制器，它可以接收外设发出的 DMA 请求，并向 CPU 发出总线请求，以及发出控制信号、报告传送结束等等。它的组成：主存地址寄存器（传送要交换的数据的地址，自增）、传送长度寄存器（记录传送长度，自减）、数据缓冲寄存器（暂存每次传送数据）、DMA 请求触发器（发出请求时置位，批准后复位）、控制/状态逻辑（传送方向、传送控制）、中断机构（传送结束时启用）
	- 中断方式是程序切换，需要保护和恢复现场，而 DMA 方式除了开始和结尾时，不占用 CPU 的任何资源；对中断请求的响应只能发生在每条指令执行完毕时；而**对 DMA 请求的响应可以发生在每个机器周期结束时**；中断传送过程需要 CPU 的干预；而**DMA 传送过程不需要 CPU 的干预**，故**数据传送速率非常高**，适合于高速外设的成组数据传送； **DMA 请求的优先级高于所有中断请求！（注意：这已经非常强了！）**；中断方式具有对异常事件的处理能力；而 DMA 方式仅局限于完成传送信息块的 I/O 操作。
	- 
	- 传送方式：停止 CPU 访存、DMA 和 CPU 交替访存、周期挪用（若 CPU 不访存则不冲突、CPU 访存则先等待 CPU 访存完成、同时访存则 IO 设备占有总线，传送一个数据后放开）
	- 传送过程：DMA 预处理（执行几条指令，完成设置并测试外设状态）、数据传输（以字节、字或者块作为基本单位，由 DMA 控制器自动实现）、后处理

#### 奇奇怪怪的错误
![[679d7695cd300f6a84cbab891ac4b55.jpg]]
死因：我们不可能通过地址线来区分存储单元和 I/O 设备。我们靠不同指令区分。

![[11deb7393f943ad654bbff61532b778.jpg]]
死因：这里磁盘是串行写入的。因为磁盘是沿着磁道写入的。

![[77eb76314a2898918fc10064ffec115.jpg]]
记一下。磁盘驱动器没有任何控制功能，不能记录状态等等信息，完全不是 I/O 接口（当然，也没有和外设连接，磁盘一般不算外设（？））

![[e7269a5e771efc44c0e34769b8d0796.jpg]]
死因：这里一般认为 DMA 的传送过程不需要中断，因而不需要保护现场

![[8201c00a704be387e2840e7678e57ba.jpg]]
死因：访管其实就是陷入 (Trap)指令，它的优先级是最高的；注意重新启动虽然看着挺唬人，但是它是最低的。因为它必须等所有其他操作都执行完才能执行。

![[0256c82e5e261744c95f3cd7d74015a.jpg]]
死因：中断优先级包括处理优先级和响应优先级。响应优先级由硬件线路确定，不便于改动，改动中断屏蔽字只会改动处理优先级，这可以实现多重中断

![[004bb3442b3f4d570840636aee31288.jpg]]
死因：只有中断允许状态的时候，中断才能被响应（可以屏蔽掉吗？）；CPU 一旦执行中断处理程序，就会陷入系统态，此时还是可以多重中断的！

![[018718478717922f0283a0b056cec79.jpg]]
死因：DMA 其实可以用于任何设备，只不过最适用于快速外部设备

![[7782870af42b0835e1720e3e765de64.jpg]]
死因：I 是对的，这就是驱动存在的意义

![[ad51f9553219a75b9d4e1252545f8b6.jpg]]
死因：注意 DMA 的优先级比所有中断都高（可以屏蔽的、不可屏蔽的）



