#TraditionalComputerScience 
## IO 设备及其控制方式
一般来说，IO 设备可以分为块设备、字符设备等。它们通过 IO 接口（设备控制器）与主机通信。IO 接口可以分为三个部分：设备控制器与 CPU 的接口（有地址、数据、控制线，有数据、状态控制寄存器）；设备控制器与设备的接口（一个设备控制器可以连接多个设备）、IO 逻辑。而 IO 端口指的是可以被 CPU 直接访问的寄存器，可以独立编址，也可以统一编址。

IO 设备有三种控制方式：
- 程序查询方式
![[Pasted image 20231128121815.png|300]]
- 程序中断方式：每条指令末尾检查中断，实现了 CPU 和外设的并行工作
![[Pasted image 20231128121953.png|300]]
- DMA 方式：在 DMA 控制方式下，外设和主存进行成批的数据传递
![[Pasted image 20231128122343.png|300]]
在中断情况下，数据传送仍然需要受到 CPU 的控制，而 DMA 模式下不需要。这进一步加快了速度。
- 通道控制：通道有自己的指令系统，CPU 只需向通道发送一条 IO 指令，通道就会执行通道指令从而完成一系列 IO 任务

### IO 软件的层次结构
- 用户层：实现与用户交互的接口，用户可以直接调用在用户层提供的、与 IO 操作有关的库函数
- 设备独立性软件：这一层使得应用程序独立于具体的设备。它的作用：执行所有设备的共有操作（分配和回收、逻辑设备名到物理设备名的映射、保护、缓冲管理和差错控制等等）、向用户层提供统一接口
- 设备驱动程序：是 IO 进程与设备控制器之间的通信程序，封装了设备的具体差别。唯一知道设备控制器配置状况，包含设备初始化、设备传输数据和处理中断的例程
- 中断处理程序：保存现场、处理中断、恢复现场

应用程序的 IO 接口也分为三种：
- 字符设备接口：传输速率低、不可寻址、以字符为单位
- 块设备接口：以块为基本单位、传输速率较高、可寻址
- 网络设备接口：

阻塞和非阻塞 IO 


## 与设备无关的软件
### 缓冲区
假设磁盘将数据写到缓冲区的时间为 $T$，缓冲区中数据传入用户区的时间为 $M$，CPU 处理一块数据的时间为 $C$。如果是单缓冲区，那么缓冲区的工作周期是 $\max (C, T) + M$；对于双缓冲的情况，则是 $\max(C+M,T)$。此外，我们也有循环缓冲和缓冲池的做法。

### 设备分配
我们共有三类设备：独占设备、分时式共享设备、假脱机技术
设备分配的数据结构包括：设备控制表、控制器控制表、通道控制表、系统设备表
- 设备控制表：一个设备控制表就表征一个设备 .控制表中的表项包括：设备类型、标识符、状态、重复执行次数、指向控制器表的指针、设备队列的队首指针等等。
- 控制器控制表：控制器标识符、状态、指向通道的指针，等等
- 通道控制表：内含与通道连接的控制器表首地址
- 系统设备表：整个系统只有一张，记录了连接到系统中的所有物理设备的情况。

设备的分配策略包括两种：
- 静态分配：主要用于对独占设备的分配。在作业开始执行前就一次性分配所需要的设备和控制器。效率低但不死锁。
- 动态分配：在执行过程中按照需要进行。可能死锁，因此可能需要银行家算法。
我们将不会发生死锁的分配方式称为“安全的分配方式”，反之称为“不安全的分配方式”。对于逻辑设备名到物理设备名的映射，采用 LUT（逻辑设备表）

### 假脱机技术
假脱机技术是一项将操作系统中的独占设备改造为共享设备的技术。该技术利用外围控制机，将 IO 设备上的数据传送到高速磁盘上，或者相反。
![[1d295d1f6d8ff64a5a663569399a1b5.jpg|400]]
用法：例如，输入数据时，将数据从输入设备经过输入缓冲区传送到输入井，从而在 CPU 需要数据时可以直接从输入井读入。记住使用假脱机技术改造打印机的实例。
特定：提高 IO 速度、将独占设备改造为共享设备、实现了虚拟设备功能

## 磁盘管理
磁盘地址使用柱面号-盘面号-扇区号。磁盘管理包含：
- 磁盘初始化：低级格式化，为每个扇区选择特殊的数据结构来填充磁盘。每个扇区的数据结构都由头部、数据区、尾部组成
- 分区：将磁盘分为一个或多个柱面组成的分区，每个分区的起始扇区和大小记录在唱片主引导记录的分区表中；此后，对物理分区进行逻辑格式化，将初始的文件系统结构存储到磁盘上
- 引导块：计算机启动时需要运行一个初始化程序，它初始化 CPU、寄存器、内存、设备控制器等，随后启动操作系统。一般在 ROM 中包含很小的装入程序，完整功能的引导程序包含在磁盘的启动块上，启动块位于磁盘的固定位置，这个磁盘称为系统磁盘
- 坏块：需要用备用块替换

### 磁盘调度算法
- 寻道时间：$T_{s}= m \times n + s$
- 旋转延迟时间：$T_{r}= \dfrac{1}{2r}$
- 传输时间：$T_{t}= \dfrac{b}{rN}$
调度算法包括：
- 先来先服务（性能不太好，有时接近于随机调度）
- 最短寻找时间优先：可能有饥饿现象
- 扫描和循环扫描算法、LOOK 和 CLOOK 算法

减少延迟时间的方法：盘面扇区交替编号，不同盘面错位命名

### 固态硬盘
固态硬盘的一个闪存由 $B$ 块组成，每块又由 $P$ 页组成。数据以页为单位读写，但是以块为单位擦除。有寿命缺陷，因此有磨损均衡技术。

