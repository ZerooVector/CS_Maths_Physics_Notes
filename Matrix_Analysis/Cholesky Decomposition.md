#MA 

## Cholesky 分解是什么？
Cholesky 分解是对正定矩阵完成的一种操作，它负责将方阵 $A$ 分解成**一个下三角矩阵 $L$ 以及其转置 $L^T$ 的乘积**。也就是：
$$
A =LL^T
$$
![[Pasted image 20230301234123.png|400]]

此外，它还有进阶版本——将任意矩阵分解成下三角阵 $L$ ，其转置 $L^T$ 和对角阵 $D$ 的乘积。，也就是
$$
A = LD^{1/2}(LD^{1/2})^T = LDL^T
$$
也可以有很多写法，例如，令 $B = D^{1/2}, R= L^T$，Cholesky 分解被写成：
$$
A = (BR)^T(BR)
$$
然而，只有正定矩阵才能执行 Cholesky 分解。一个矩阵是正定的，意味着它对应的二次型的值恒为正：
$$
x^TAx >0\ ,\ \forall x
$$
## Cholesky 分解的几何意义
### 特殊情况 1：对角全 1，其余位置是余弦值的矩阵
并不是所有矩阵都能进行 Cholesky 分解，而且，不是所有矩阵的 Cholesky 分解都有很明显的几何意义。因此，我们只讨论一个非常特殊的情况：矩阵的主对角全 1，非主对角的元素为余弦值：
$$
P = \begin{bmatrix}
1 & \cos \theta_{1,2}\\
\cos \theta_{1,2} & 1
\end{bmatrix}
$$
那么，矩阵分解的结果是：
$$
R = LL^T = R^TR = 
\begin{bmatrix}
1 & 0\\
\cos \theta_{1,2} & \sin \theta_{1,2}
\end{bmatrix}
\begin{bmatrix}
1 & \cos \theta_{1,2}\\
0 & \sin \theta_{1,2}
\end{bmatrix}
$$
将 $R$ 按照列向量展开：$R = [r_1,r_2]$，容易发现 $\cos <r_1,r_2> = \cos \theta_{1,2}$ 。

接下来，我们从线性变换的角度下看矩阵 $R$ 的作用。根据我们之前的理论，这个是将原来的基向量经过线性变换后，在某一特定出口基下的坐标（在这里，出口基被指定为和入口基相同），我们可以发现，矩阵 $R$ 将原本垂直的一对正交基变换成了夹角为 $\theta$ 的一组向量。这其实是一种“开合”变换。也就是说，你在矩阵的对角上输入的余弦值是多少，矩阵所代表的线性变换的夹角就是多少。
![[Pasted image 20230301235138.png|400]]

这个变换的行列式值为 $\sin \theta_{1,2}$，这可以从面积的变化上观察出来:
![[Pasted image 20230301235427.png|400]]

### 特殊情况 2 ： 对余弦值矩阵进行一下缩放
如果一个矩阵是这样子的：
$$
P = \begin{bmatrix}
a^2 & ab\cos \theta_{1,2}\\
ab\cos \theta_{1,2} & b^2
\end{bmatrix}
$$
处理这个矩阵，我们可以先将其打开：
$$
P = 
\begin{bmatrix}
a & \\
& b
\end{bmatrix}
\begin{bmatrix}
1 & \cos \theta_{1,2}\\
\cos \theta_{1,2} & 1
\end{bmatrix}
\begin{bmatrix}
a & \\
& b
\end{bmatrix}
$$
然后再把 Cholesky 分解作用在中间的一部分上：
$$
P = 
\begin{bmatrix}
a & \\
& b
\end{bmatrix}
\begin{bmatrix}
1 & 0\\
\cos \theta_{1,2} & \sin \theta_{1,2}
\end{bmatrix}
\begin{bmatrix}
1 & \cos \theta_{1,2}\\
0 & \sin \theta_{1,2}
\end{bmatrix}
\begin{bmatrix}
a & \\
& b
\end{bmatrix}
$$
将面积缩放的矩阵记为 $S$，而负责旋转基底的矩阵记为 $R$，那么上面这个变换被记为：
$$
P = (RS)^TRS
$$
将 $RS$ 矩阵左乘到任何一个向量上，得到的结果是将这个向量先缩放，再旋转：
![[Pasted image 20230303084838.png|400]]

而且，向量 $x_1,x_2$ 之间的夹角仍然是 $\theta$ 。

### 特殊情况 3：推广到三维空间中
如果我们指定一个三维方阵，对角线全部以 1 填充，非对角线全部填入两个向量间的夹角，也就是：
![[Pasted image 20230303085209.png|250]]

对它进行分解，可以得到对应的上三角矩阵：
![[Pasted image 20230303085252.png|400]]
容易验证，这个矩阵中的三个列向量也是成指定的角度。
现在，我们可以从几何上给出 Cholesky 分解的用途——**构造非正交的基底**。只要在矩阵的对角线上填入全 1，其余位置填入指定的夹角的余弦值，执行 Cholesky 分解就会使得分解得到的矩阵的列向量成为具有指定夹角的非正交基。但是，要想构造出三个指定夹角的向量，这些夹角之间必须满足某些几何上的约束条件，这些条件恰好也确保了矩阵的正定：
![[Pasted image 20230303085629.png|300]]

一组可行的非正交基的构造如下：
![[Pasted image 20230303085816.png|400]]

## 从 Gram 矩阵到余弦相似度
我们知道，数据矩阵的 Gram 矩阵是其列向量的标量积。也就是
$$
(g_{ij}) = x_i^Tx_j
$$

![[Pasted image 20230303093320.png|400]]
定义一个对角阵作为缩放矩阵，使得它的对角上是所有向量的二范数，那么
$$
S = \mathrm{diag}(||x_1||,||x_2||,\cdots,||x_n||)
$$
计算一个矩阵 $C$，使得：
$$
C = S^{-1}GS^{-1} 
$$
那么 $C$ 就是余弦相似度矩阵：
![[Pasted image 20230303094023.png|300]]
这个矩阵可以用于被 Cholesky 分解，从而构造指定的基向量

