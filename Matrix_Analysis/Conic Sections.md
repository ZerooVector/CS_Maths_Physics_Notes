#MA  

## 圆锥曲线的表达式和性质
在高中，我们接触到的圆锥曲线表达式是：
$$
Ax_{1}^{2}+B x_{1}x_{2}+Cx_{2}^{2}+Dx_{1}+Ex_{2}+F = 0
$$
现在，我们将其写成矩阵形式：
$$
\frac{1}{2}[x_{1}\ x_{2}]\begin{bmatrix}2A & B  \\ B & 2C\end{bmatrix} \begin{bmatrix}x_{1} \\ x_{2}\end{bmatrix}+[D\  E]\begin{bmatrix}x_{1} \\ x_{2}\end{bmatrix} + F = 0
$$
更一般地，上式可以写成：
$$
\frac{1}{2}x^{T}Qx + w^{T}x+F = 0
$$
那么，矩阵 $Q$ 的行列式就决定了圆锥曲线的形状
$$
\mathrm{det}(Q) = 4AC-B^2
$$
大于 0 对于椭圆，等于 0 对应抛物线，小于 0 对应双曲线。

圆锥曲线的中心可以通过函数：
$$
f(x) = \frac{1}{2}x^{T}Qx +w^{T}x 
$$
的驻点来给出。

## 圆锥曲线的生成：从单位圆开始
### 通过线性和仿射变换生成任意的圆
一个单位圆的表达式是：
$$
x^{T} x - 1 = 0
$$
一个被缩放过的圆的表达式是：
$$
x^{T}\mathrm{diag}(\frac{1}{r},\frac{1}{r})\cdot \mathrm{diag}(\frac{1}{r},\frac{1}{r})x = 0
$$
这个式子体现的几何意义是一个“反向变换”的过程：既然将一个单位圆放大之后就得到了任意的圆，那么我们现在将一个任意圆 $C$ 的大小缩小到原来的 $\frac{1}{r}$，就回到了单位圆。
为了使得这种几何意义看起来更清晰，我们令：$S = \mathrm{diag}(r,r)$，那么上式还可以写完：
$$
x^{T}S^{-1}S^{-1}x = 1
$$
如果要生成圆心不在原点处的圆，那么只需要平移一下：
$$
(x-c)^{T}\begin{bmatrix} \frac{1}{r} & 0  \\  0 & \frac{1}{r}\end{bmatrix}  \begin{bmatrix} \frac{1}{r} & 0 \\
0 & \frac{1}{r}\end{bmatrix} (x-c)-1=0
$$
![[Pasted image 20230311145201.png|400]]

### 从单位圆旋转生成椭圆
考虑一个单位圆解析式是：
$$
z^{T}z= 1
$$
那么我们现在考虑将单位圆上的每个点先缩放、再旋转、再平移：
$$
RSz+c =x
$$
其中，$R$ 是一个正交矩阵，$S$ 是一个对角矩阵。那么，一个旋转椭圆的解析式就被写为：
$$
(S^{-1}R^{T}(x-c))^{T}(S^{-1}R^{T}(x-c)) - 1 = 0
$$
展开这个表达式，得到：
$$
(x-c)^{T}RS^{-2}R^{T}(x-c) - 1 = 0
$$

其中，$$
S = \begin{bmatrix}a^{-2} &  \\ & b^{-2}\end{bmatrix}
$$
注意：在第一部分中我们提过，一般的二次型会记成
$$
(x-c)^{T}Q(x-c)-1 = 0
$$
这个时候将 $Q$ 做特征值分解，你就会看到：
$$
Q = R\Lambda R^{T}
$$
这个时候，两个特征值显然就与椭圆的长短轴有关系。将所有部分打开，就能整理出椭圆的一般解析式：
![[Pasted image 20230311150500.png|300]]

## 圆锥曲线的其他性质
### 双曲线的生成
单位双曲线是这样的：
$$
z^{T}\begin{bmatrix}1 &  \\  & -1 \end{bmatrix}z - 1 = 0 
$$

显然，上面用于生成椭圆的步骤也是可以用于生成双曲线的，只要令：
$$
RSz+c =x
$$
### 圆锥曲线的切线和法线
我们使用一个很特殊的圆锥曲线，说明切线和法线的求法：
考虑中心位于原点处的椭圆，其解析式为：
$$
 \frac{x_{1}^{2}}{a^{2}}+ \frac{x_{2}^{2}}{b^{2}} = 1
$$
如果构造下面的二元函数：
$$
f(x_{1},x_{2}) = \frac{x_{1}^{2}}{a^{2}}+ \frac{x_{2}^{2}}{b^{2}} 
$$
那么，椭圆曲线本身就是这个函数的等值线。我们知道，函数在某点 $(p_{1},p_{2})$ 的梯度方向应当与其在此点的等值线方向垂直，我们只要计算出梯度向量的方向，也就算出了法向量的方向：
$$
n = \nabla f(x) = \begin{bmatrix} \frac{2p_{1}}{a^{2}}\\ \frac{2p_{2}}{b^{2}}\end{bmatrix}
$$
如果想要求出切线，只需要使得从 $(p_{1},p_{2})$ 指向切线上一点 $(x_{1},x_{2})$ 的向量与上面求出的椭圆曲线法向量的方向垂直，也就是：
$$
[ \frac{2p_{1}}{a^{2}} \ \ \frac{2p_{2}}{a^{2}}]\begin{bmatrix} x_{1}-p_{1}  \\  x_{2}-p_{2}\end{bmatrix} = 0
$$
对于圆锥曲线的一般式：
$$
Ax_{1}^{2}+B x_{1}x_{2}+Cx_{2}^{2}+Dx_{1}+Ex_{2}+F = 0
$$
也可以使用相同的操作

## 圆锥曲线变换的应用——多元高斯分布与马氏距离
### 多元高斯的方程——将实际分布标准化，得到标准分布再代入
注意到 $D$ 维上的多元高斯分布的表达式：
$$
f(x) = \frac{\exp \left( - \frac{1}{2}(x-\mu)^{T}\Sigma^{-1}(x-\mu) \right)}{(2 \pi)^\frac{D}{2}|\Sigma|^\frac{1}{2}}
$$
那么这里的协方差矩阵 $\Sigma$ 也是实对称矩阵，可以进行特征值分解
$$
\Sigma = V\Lambda V^{T}\ \ \Rightarrow\ \ \Sigma^{-1} = V\Lambda ^{-1}V^{T}
$$
把它代入椭圆的表达式，可以发现：
$$
(x-\mu)^{T}V \Lambda^{-1}V^{T}(x-\mu) = [\Lambda^\frac{-1}{2}V^{T}(x-\mu)]^{T}[\Lambda^\frac{-1}{2}V^{T}(x-\mu)]
$$
那么，我们令：
$$
z = \Lambda^{\frac{-1}{2}}V^{T}(x - \mu)
$$
实际上我们就看到了和上面圆锥曲线的生成一样的过程。在上面圆锥曲线的生成过程中，我们是将单位圆中的 $z$ 进行拉伸、旋转和平移变换，得到了圆锥曲线中的 $x$，这里，我们也是将标准正态分布的随机变量 $z$ 经过了拉伸、旋转和平移，得到了实际的随机变量 $x$。上面的式子描述了将随机变量 $x$ “反向地”标准化的过程。
也就是说，多元正态分布上面的一堆东西就是在描述“如何将实际的随机变量 $x$ 经过标准化后，得到随机变量 $z$”。也就是说，多元正态分布可以写成：
$$
f(x) = \frac{\exp( - \frac{1}{2}z^Tz)}{(2\pi)^{\frac{D}{2}}|\Sigma|^{\frac{1}{2}}}
$$
那么，$z$ 就是一个遵循标准正态分布的随机变量。你甚至可以理解为，我们已经知道了标准正态分布的式子，那么拿到不服从标准正态分布的变量 $x$ 的时候，我们需要先将其标准化，然后再代入式子里。这个标准化的过程如下图所示：
![[Pasted image 20230311154536.png|400]]

多元正态分布的 PDF 的等值线都是椭圆，在我们的标准化过程中，实际上我们就是在旋转和缩放这些椭圆等值线。

### 马氏距离的意义
那么，我们已经知道了，将原始的随机变量记为 $x$，将标准正态分布中，已经被标准化的随机变量记为 $z$，那么，我们可以计算数据被标准化后两个点之间的距离（显然，此时，方差的影响被抛弃了，距离将更能真实地反应数据间的间隔情况）。我们令：
$$
d = (x- \mu)^{T}\Sigma^{-1}(x-\mu) = ||\Lambda^{-1/2}V^T (x-\mu) ||=||z||_{2}^ 2
$$
这样的距离就被称为 Mahal Distance 
![[Pasted image 20230311155923.png|400]]

### 高斯分布的分母上是什么
最后，我们来说说分母上是什么。一个 $D$ 维的高斯分布的分母上是：
$$
(2\pi)^{\frac{D}{2}}|\Sigma|^{\frac{1}{2}}
$$
第一部分是一个归一化常数，而第二部分，是因为我们在将 $z$ 转化到 $x$ 的时候，将整个 PDF 图形的“底面积”扩大了 $\mathrm{det}(\Sigma)^\frac{1}{2}$ 倍（注意，是 $\Lambda^\frac{1}{2}$ 这一项在起作用），那么，现在，为了使得这个图形的体积依然保持在 1 不变，我们需要将这个面积的扩大倍数除回来。



