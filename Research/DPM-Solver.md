---
banner: 
title: DPM-Solver
creation_date: 2024-04-03
domain: 应用数学
publish: NIPS2022
tags:
  - Research
---
## 基础信息区
### 本文面对了什么挑战？
Diffusion 模型的逆向过程可以被写为一个 ODE，但如果使用通常的 ODE 求解器来求解它，那么步长不能太长，否则会带来大量误差。因此，传统的方法计算太慢。

### 一句话概括本文的内容？
本文中根据 ODE 的特殊形式（半线性 ODE）提出了一种全新的求解器，用于实现对这种 ODE 的快速、精确求解。这种求解器的基本思路是：通过一些数学技巧，将方程中能求出解析解的部分暴露出来。

### 你对本文作何评价？
一个基于数值分析的文章。

## 笔记区
### Preliminaries
DDPM 的正向加噪过程可以写成一个 SDE：
![[Pasted image 20240403112718.png]]

同理，从 $q_{T}(x_{T})$ 开始的逆向去噪过程也可以写成 SDE:
![[Pasted image 20240403112912.png]]
通过这个 SDE 我们可以复原图像。在这里面，我们只有 $\nabla_{x} \log q_{t}(x_{t})$ 不知道。在初版 DDPM 里面的做法是使用一个网络对 $- \sigma_{t} \nabla_{x} \log q_{t} x(t)$ 进行预测，将预测的结果记为 $\epsilon_{\theta}(x_{t},t)$，从而上面的方程变成：
![[Pasted image 20240403113055.png|400]]
在 SDE 中仍然要对逆向布朗运动 $\bar w_{t}$ 进行采样，因此步长不能太长。一种更直接的方法是直接考虑与这个 SDE “等效”的 ODE：
![[Pasted image 20240403113321.png|500]]
或者代入神经网络的预测结果：
![[Pasted image 20240403113443.png|600]]
那么现在要来解它。

### Methodology
以前的求解器是直接使用整个 $h_{\theta}(x_{t} , t)$，但是这没有充分利用方程的结构。注意到 $h_{\theta}$ 由两项组成，第一项是线性的，而第二项是非线性的。这种方程被称为“半线性”方程，其解可以使用常数变易法求出。
![[Pasted image 20240403113805.png|500]]
作者的第一个观察是：如果我们引入一个常数 $\lambda = \log(\dfrac{\lambda_{t}}{\sigma_{t}})$ ，就可以显著简化上面方程的形式。通过对 $g_{t}$ 进行换元重写立刻得到：
![[Pasted image 20240403113944.png|500]]
接下来，作者希望将右边的一项换成以 $\lambda$ 为自变量（注意：这样一换元，$\dfrac{\mathrm{d}\lambda_{\tau}}{\mathrm{d}\tau}$ 立刻被消去，从而形式更简单）：
![[Pasted image 20240403114125.png|400]]
求解器是基于这个形式。

在数值求解时，将时间步离散成 $t_{0},\cdots,t_{M}$，于是将上面的方程离散化：
![[Pasted image 20240403114412.png|500]]
这里作者认为 $\hat \epsilon_\theta$ 的高阶导数是好估计的，所以我们将其泰勒展开：
![[Pasted image 20240403114538.png]]
这个时候，右侧的积分可以被解析地积出。据此我们就构造了求解器。




