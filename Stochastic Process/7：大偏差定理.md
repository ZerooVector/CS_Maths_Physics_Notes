#StochasticProcess 

根据大数定律，我们已经知道了 $\dfrac{S_{n}}{n} \rightarrow \eta$，也就是说，对于 $y \not =  \eta$，$\dfrac{S_{n}}{n}$ 接近 $y$ 的概率快速趋于 0。因此，我们将 $\{|\dfrac{S_{n}}{n} - y| < \epsilon\}$ ，且 $y \not = \eta$ 的事件称为大偏差事件。我们定义矩母函数和累积生成函数：
$$
M(\lambda) = \mathbb{E} (\exp(\lambda X_{i})) \ , \  \Lambda(\lambda)= \log M(\lambda)
$$
将 $\Lambda(\lambda)$ 做勒让德变换，换成参数为 $x$ 的函数：
$$
I(x) = \sup_{\lambda}\{x \lambda - \Lambda(\lambda)\}
$$
设 $\mu_{n}(\Gamma) = \mathbb{P}\left(\dfrac{S_{n}}{n} \in \Gamma\right)$，那么我们有如下定理：
>[!note] 大偏差定理
> $\{\mu_{n}\}$ 满足：
> - 对于任意闭集 $F \in \mathcal{R}$：$\lim_{n \rightarrow\infty } \sup \dfrac{1}{n} \log \mu_{n}(F) \le \inf_{x \in F}I (x)$
> - 对于任意开集 $G \in \mathcal{R}$：$\lim_{n \rightarrow\infty } \inf \dfrac{1}{n} \log \mu_{n}(G) \ge \inf_{x \in G}I (x)$
> - 综合以上两点，我们得到 $\mu_{n}(\Gamma) \approx \exp(- n \inf_{x \in  \Gamma} I(x))$，这里的 $\approx$ 意味着对数等价。

由此可见，大偏差事件的概率大约是指数衰减的，$I(x)$ 被称为速率函数。在证明这个定义之前，我们需要了解勒让德变换的一些性质：
>[!note] 勒让德变换的性质
>设 $f : \mathbb{R}^{d} \rightarrow \bar R = R \cup \{\infty\}$ 是下半连续的凸函数，而 $F$ 是其勒让德变换 $F (y) = \sup_{X}\{(x,y) - f(x)\}$，那么有性质：
>- $F$ 也是下半连续凸函数
>- 不等式 $(x, y) \le f (x) +  F(y)$ 成立
>- 共轭关系成立：$f (x) = \sup_{y} \{(x,y) - F(y)\}$

我们可以看一下 $I(x)$ 为什么是 $\Lambda(x)$ 的勒让德变换。假设大偏差原理成立，那么我们可以大致估计：
$$
\mu_{n}(dx) \propto \exp(- n I(x)) dx
$$
根据拉普拉斯渐进估计：
$$
\lim_{n \rightarrow \infty } \dfrac{1}{n} \log \mathbb{E}^{\mu_{n}} (\exp( n \Phi(x))) = \lim_{n \rightarrow\infty } \dfrac{1}{n} \log  \int \exp(n \Phi(x)) \mu_{n}(dx) \approx \sup_{x}\{\Phi(x) - I(x)\}
$$
若取 $\Phi (x) = \lambda x$，那么我们有：
$$
\mathbb{E}^{\mu_{n}} (\exp(n \lambda x))  = \mathbb{E} \exp\left(\lambda \sum_{i=1}^{n} X_{i}\right)  = [\mathbb{E} \exp( \lambda X_{i})]^{n}  = (M(\lambda))^{n}
$$
这就可以看出 $\Lambda(\lambda)$ 与 $I(x)$ 互为勒让德变换。

>[!note] 速率函数的性质
>速率函数满足以下性质：
>- $I(x)$ 是凸函数而且下半连续
>- $I(x)$ 非负，$I (\eta) = 0$
>- $I(x)$ 在 $[\eta , + \infty )$ 不减，而在 $(- \infty , \eta]$ 不增
>- 如果 $x > \eta$，那么 $I (x) = \sup_{\lambda > 0} \{\lambda x - \Lambda(\lambda)\}$；如果 $x < \eta$，那么 $I (x) = \sup_{\lambda < 0}\{\lambda x - \Lambda(\lambda)\}$

证明：对于 a)， $\Lambda(\lambda)$ 的凸性由 Holder 不等式保证：
$$
\begin{align*}
\Lambda(\theta \lambda_{1} + (1- \theta ) \lambda_{2})  &=   \log \mathbb{E}(\exp(\theta\lambda_{1} X_{i}) \exp((1 - \theta) \lambda_{2} X_{i}))\\
&\le \log ((\mathbb{E}\exp(\lambda_{1} X_{i})^{\theta}(\mathbb{E} \exp(\lambda_{2} X_{i}))^{1-\theta} )\\
&= \theta \Lambda(\lambda_{1}) + (1 - \theta) \Lambda(\lambda_{2})
\end{align*}
$$
那么 $I(x)$ 的凸性由勒让德变换的性质给出。
对于 b)，取 $\lambda =0$，立刻看出 $I(x) \ge  0$，另外，根据 Jensen 不等式：
$$
\Lambda(\lambda) = \log  \mathbb{E} \exp(\lambda X_{i}) \ge  \log \exp(\lambda \eta) = \lambda \eta 
$$
这意味着：$I (\eta) \le  0$。从而 $I (\eta) = 0$。
对于 c)，利用 $I(x)$ 的凸性和它在 $x = \eta$ 处取得最小值的事实就可得到
对于 d)，如果 $x  > \eta$，那么在 $\lambda \le  0$ 时：
$$
\lambda x - \Lambda(x) \le  \lambda \eta   - \Lambda(\lambda) \le  0 
$$
因此上确界只会在 $\lambda >0$ 时取到，另一边同样得证。

现在我们来证明大偏差定理本身。不失一般性，我们仍然设 $\eta = 0$。首先证明上界：设 $x>0$，$J_{x} = [x , + \infty)$，对于 $\lambda > 0$ 有：
$$
\begin{align*}
\mu_{n}(J_{x}) &= \int_{x}^{\infty} \mu_{n}(dy)  \\
&\le \exp(- \lambda x) \int_{x}^{\infty}  \exp(\lambda y) \mu_{n}(dy)\\
&\le  \exp(- \lambda x) [M(\lambda)]\\
&= \exp(- \lambda x) \left[M\left(\dfrac{\lambda}{n}\right)\right]^{n}
\end{align*}
$$
将 $\lambda$ 换成 $n \lambda$，那么：
$$
\dfrac{1}{n} \log \mu_{n}(J_{x}) \le  - ( \lambda x  - \Lambda(\lambda))
$$
因此：
$$
\dfrac{1}{n} \log  \mu_{n}(J_{x}) \le  - \sup_{\lambda > 0}\{\lambda x - \Lambda(x)\} = - I(x)
$$
定义 $\tilde J_{x} = ( - \infty , x]$，我们可以使用类似的推理得到：
$$
\dfrac{1}{n} \log  \mu_{n} (\tilde J_{x}) \le - I(x)
$$
对于一个闭集 $F \in \mathcal{R}$，如果 $0 \in F$，那么 $\inf_{x \in F} I (x) = 0$，定理显然是成立的。否则，设 $(x_{1},x_{2})$ 是最大的符合条件 $(x_{1}, x_{2}) \cap F = \emptyset$，且 $0 \in (x_{1},x_{2})$，那么 $x_{1}, x_{2} \in F$ ，$F \subset \tilde J_{x_{1}} \cup J_{x_{2}}$，根据 $I(x)$ 的单调性，我们有：
$$
\begin{align*}
\lim_{n \rightarrow  \infty } \sup \dfrac{1}{n} \log \mu_{n}(F)
 &\le  \max (\lim_{n \rightarrow  \infty } \sup \dfrac{1}{n} \log \mu_{n}(\tilde J_{x_{1}}), \lim_{n \rightarrow  \infty } \sup \dfrac{1}{n} \log \mu_{n}( J_{x_{2}}))\\
&\le - \min(I(x_{1}), I(x_{2}))\\
&= - \inf_{x \in F} I(x)
\end{align*}
$$
下面证明下界：设 $G$ 是非空开集，我们要证明对于任意 $x \in G$，都有：
$$
\lim \sup  \dfrac{1}{n} \log \mu_{n}(G)  \ge  - I(x)
$$
现在固定 $x$ 并假设 $I(x)$ 有限。情形 1：在 $x$ 处，$I(x)$ 的上确界无法取到，那么显然 $x \not = 0$，这里设 $x>0$，现在有一列 $\lambda_{n} \rightarrow \infty$，使得：
$$
I(x) = \lim_{n \rightarrow \infty } (\lambda_{n}x - \Lambda (\lambda_{n}))
$$
那么：
$$
\int_{- \infty }^{x^{-}} \exp(\lambda_{n}(y - x)) \mu (dy) \rightarrow 0 
$$
而：
$$
\int_{x}^{\infty} \exp(\lambda_{n}(y-x)) \mu(dy) =  \int_{- \infty}^{+\infty} \exp( \lambda_{n}(y-x)) \mu(dy)  = \exp(- I(x))  <\infty 
$$
直观上来看，因为 $\lambda \rightarrow \infty$，那么我们必然有 $\mu ((x,+ \infty)) = 0$，
$$
\exp(- I(x)) = \mu(\{x\})
$$
从而立刻得到：
$$
\mu_{n}(G) \ge  \mu_{n}(\{x\}) \ge (\mu(\{x\}))^{n} = \exp(-nI(x))
$$
所以：
$$
\dfrac{1}{n} \log \mu_{n}(G) \ge  -I(x)
$$
情形 2：假设上确界在 $X_{0}$ 处取到，那么：
$$
I(x) = \lambda_{0} x - \Lambda(\lambda_{0})
$$
那么 $x = \Lambda' (\lambda_{0}) = \dfrac{M'(\lambda_{0})}{M(\lambda_{0})}$。定义一个新的概率测度：
$$
\tilde \mu(dy) = \dfrac{1}{M(\lambda_{0})} \exp( \lambda_{0} y) \mu (dy )
$$
它的期望是：
$$
\int y \tilde \mu(dy) = \dfrac{1}{M(\lambda_{0}) } \int y \exp(\lambda_{0}y) \mu(dy) = \dfrac{M'(\lambda_{0})}{M(\lambda_{0}) } = x
$$
如果 $x \ge  0$，那么 $\lambda_{0} \ge  0$，对于足够小的 $\delta$ ，$(x - \delta , x + \delta ) \subset G$，这里记 $D = \{|\dfrac{1}{n} \sum_{j} y_{j} - x| < \delta\}$ ，那么：
$$
\begin{align*}
\mu_{n}(G) &\ge \mu_{n}(x - \delta  ,  x+\delta )\\
&= \int_{D} \mu(dy_{1}) \cdots  \mu(dy_{n})\\
&\ge  \exp(- n \lambda_{0} (x + \delta)) \int_{D} \exp(\lambda_{0}(y_{1} + \cdots  + y_{n})) \mu(dy_{1})\cdots \mu(dy_{n})\\
&= \exp(- n \lambda_{0} (x + \delta )) M(\lambda_{0})^{n} \int_{D} \tilde \mu(dy_{1})\cdots \tilde \mu(dy_{n})
\end{align*}
$$
利用弱大数定律：
$$
\int_{D} \tilde \mu(dy_{1})\cdots \tilde \mu(dy_{n}) \rightarrow 1
$$
因此：
$$
\lim\inf \dfrac{1}{n} \log \mu_{n}(G) \ge  -  \lambda_{0}(x + \delta ) + \Lambda(\lambda_{0}) = - I(x) - \lambda_{0} \delta 
$$


接下来我们给出一些应用：对于伯努利分布，$\Lambda (\lambda) = \log(p\exp(\lambda) + q)$，因此我们有：
$$
I(x) = \begin{cases}
x \log \dfrac{x}{p} + (1-x) \log \dfrac{1-x}{q} \quad x \in [0,1] \\
\infty \quad  otherwise
\end{cases}
$$
这里的函数 $I$ 有另一个名字：相对熵（KL 散度），定义了两个离散分布之间的距离：
$$
D(\mu||\nu) = \sum_{i} \mu_{i} \log \dfrac{\mu_{i}}{\nu_{i}}
$$
我们再考虑一个例子：设一个系统由 $n$ 个独立的粒子组成，每个粒子的自旋以 $\dfrac{1}{2}$ 的概率向上或向下，两个态的能量分别为 $+1$ 和 $-1$。记 $n$ 粒子 系统的平均能量为 $h_{n}$，根据大偏差定理，我们有：
$$
I(E) = \lim_{n  \rightarrow \infty } - \dfrac{1}{n} \log \mathbb{P} (h \in [E,E + d E])
$$
记 $W(E)$ 是能量 $E$ 对应的微观态数目，那么：
$$
I(E)  = \lim_{n \rightarrow \infty } - \dfrac{1}{n} \log  \dfrac{W(h_{n} \in [E,E+dE])}{2^{n}}
$$
如果使用 $S(E)$ 代表 $\dfrac{S_{n}(E)}{n}$ 的极限，那么：
$$
k_{B}I(E) = k_{B} \log 2 - S(E)
$$
因此，速率函数与系统的熵有关。熵越大，系统越混乱，速率函数也就越小。

现在考虑一个正则系综，定义 $n$ 粒子体系的总能量 $H_{n}(\omega)$ 的对数生成函数：
$$
\Lambda(\lambda) = \lim_{n \rightarrow\infty } \dfrac{1}{n} \log \mathbb{E} \exp(\lambda H_{n})
$$
取 $\lambda = - \beta = \dfrac{1}{k_{B}T}$，那么：
$$
\Lambda(\lambda) = \lim_{n \rightarrow \infty } \dfrac{1}{n} \log\left(\sum_{\omega}  \exp( - \beta H_{n}(\omega))\right) - \log 2
$$
定义配分函数 $Z_{n}(\beta) = \sum_{\omega} \exp( - \beta H_{n}(\omega))$，亥姆霍兹自由能可以写成：
$$
F_{n}(\beta) = - \beta^{-1} \log Z_{n}(\beta)
$$
我们可以看到：
$$
\Lambda( - \beta) = - \beta F(\beta ) - \log 2
$$
按照大偏差定理，对数生成函数和速率函数应该互为勒让德变换，也就是说：
$$
- \beta F(\beta) - \log2 = \sup_{E} \{- \beta E - \log 2 + \dfrac{1}{k_{B}} S(E)\}
$$
也就是说：
$$
F(\beta) = \inf_{E}\{E - TS(E)\}
$$
极值点：
$$
\dfrac{\partial  S(E)}{\partial E}|_{E = E^{\star}} = \dfrac{!}{T}
$$


