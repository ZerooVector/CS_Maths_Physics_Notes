#StochasticProcess 

为了事实蒙特卡洛方法，我们需要生成随机数。在计算机模拟中，我们生成的随机数都是伪随机数。换言之，如果一个人生成很多随机数，那么他最终会发现这些随机数开始重复自身。但是，我们只希望在有限的时间内使得这些数据看起来像随机数。最简单的情况下，我们来生成 $[0,1]$ 上的均匀分布。

### 线性同余生成器（LCG）
这种生成器非常简单：
$$
X_{n+1} = aX_{n} +b  \mod  m 
$$
$\dfrac{X_{n}}{m}$ 就给出了我们想要的随机数。我们显然会关心这个东西的周期是多少。
>[!note] LCG 的周期
>LCG 的周期是 $m$，当且仅当
>- $b$ 与 $m$ 互质
>- $m$ 的每一个质因数整除 $n-1$
>- 如果 $4$ 整除 $m$，那么 $4$ 必须整除 $a-1$

如果选择 $m = 2^{k}$，$a = 4c+1$，$b$ 为偶数，那么这个条件就得到满足，$X_{0}$ 就是随机数的种子。然而，这一方法在生成高维随机向量上的效果很差：
>[!note]
>由 LCG 生成的随机向量 $(X_{n},X_{n+1} ,\cdots, X_{n+s-1})$ 最多分布在 $(s!m)^{\frac{1}{s}}$ 个平行等距的超平面上。

 各种统计检验可以用来检查随机数生成的质量。我们的原假设 $H_{0}$ 是：$\{X_{1},X_{2},\cdots X_{N}\}$ 是在 $[0,1]$ 上均匀分布，可以使用的检验方法有：
 - 等分布检验：将 $[0,1]$ 划分为 $K$ 个区间，计算掉进每个区间内点的数量，之后使用 $\chi^{2}$ 检验
 - 序列检验：与等分布检验类似，只不过推广到 $s$ 维的立方体中取点。
 - Run Test：将长度为 $i$ 的单调递增的子序列的个数记为 $R_{i}$，可以证明在理想情况下，$R_{i}$ 应当服从正态分布。

### 逆变换方法
设 $F$ 是 $X$ 的分布函数，定义 $F$ 的广义逆：
$$
F^{-}(u) = \inf\{x:F(x)\ge u \}
$$
那么 $X = F^{-}(U)$ 的分布函数就是 $F$ 。

证明：如果 $F$ 是连续且单调递增的，我们有 $F^{-}(u) = F^{-1}(u)$，从而：
$$
\mathbb{P}(X \le x) = \mathbb{P}(F^{-1}(U) \le x) = \mathbb{P}(U \le F(x)) = F(x)
$$
对于其他的情况，我们有 $\{(u, x):F^{-}(u) \le x\} = \{(u,x) : F(x) \ge u\}$，因此也可得证。

用这种方法生成高斯分布时，需要取：
$$
F^{-1}(x) = \sqrt 2 \text{erf}^{-1}(2x - 1)
$$
其中 $\mathrm{erf}$ 是误差函数 $\mathrm{erf}(x) = \dfrac{2}{\sqrt \pi} \int_{0}^{x} \exp(- t^{2})dt$。这个方法很低效，因为需要求解积分方程，因此我们来介绍一种更有效的生成正态分布的方法。

#### 生成高斯随机变量的方法：Box-Muller 算法
考虑二维上两个独立高斯分布组成的联合高斯分布，使用极坐标，我们得到：
$$
\dfrac{1}{2 \pi} \exp\left(- \dfrac{x_{1}^{2} + x_{2}^{2}}{2}\right)dx_{1}dx_{2} = \left(\dfrac{1}{2\pi} d \theta \right) \cdot \left(\exp\left(- \dfrac{r^{2}}{2}\right)r dr\right) 
$$
这意味着 $r$ 和 $\theta$ 也是独立的。那么，我们令 $X, Y$ 在 $[0,1]$ 均匀分布，再令 $Z_{1}= = R \cos  \Theta, Z_{2} = R \sin  \Theta$，那么 $Z_{1},Z_{2}$ 都服从正态分布。

#### 随机变量的叠加
有的时候，一个分布是多个随机变量叠加得到的。例如 $X,Y$ 都是 $[0,1]$ 上的均匀分布，它们叠加得到的分布是：
$$
f(z) = \begin{cases}
z \quad  0 < z< 1  \\
2-z \quad 1 \le z <2
\end{cases}
$$
面对这种情况，我们的标准做法是这样的：
$$
f(x) = \sum_{i=1}^{K} \alpha_{i}g_{i}(x)
$$
我们将其重写为：
$$
f(x)  = \sum_{i=1}^{K} \beta_{i}h_{i}(x) \quad \beta_{i} = \alpha_{i} \int g_{i}(x) dx \quad  h_{i} = \dfrac{ g_{i}(x) }{ \int g_{i}(x) dx}
$$
这实际上是做了个归一化，使得 $\int h_{i}(x) dx = 1,\sum \beta_{i} = 1$。在生成的时候，只要先按照 $\beta$ 的多项分布抽取一个下标，再按照对应的 $h_{i}$ 生成即可。

### 接受-拒绝方法
逆变换方法通常只适用于 $F(x)$ 的反函数有解析解的情形，现在我们给出适用于更加一般情形的方法。
![[Pasted image 20240805205753.png|400]]
如图，我们在阴影区域内采样一个均匀分布，那么此时显然这个随机变量在 $x$ 方向的边缘分布就是 $p(x)$，采样过程只需简单三步：
- 生成 $X_{i} \sim \mathcal{U}[a,b]$
- 生成 $Y_{i} \sim \mathcal{U}[0,d]$
- 如果 $0 \le Y_{i} < p(X_{i})$ 则接受，否则拒绝

如果 $p(x)$ 在 $(- \infty , +\infty )$ 都有取值，我们可以引入一个处处 $f>p$ 的比较函数，设 $\int  f (x) dx = Z$，记 $F (x) = \int_{- \infty }^{x} f(x)dx$，该方法要求我们有 $F^{-1}(x)$ 的解析形式。方法被改良为：
- 生成 $X_{i} \sim F^{-1}(ZW_{i})$，其中 $W_{i} \sim \mathcal{U}([0,1])$
- 生成 $Y_{i} \sim \mathcal{U}[0,f(X_{i})]$
- 如果 $0 \le  Y_{i} < p(X_{i})$，接受，否则拒绝



